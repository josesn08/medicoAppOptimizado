<div class="container mt-5">
  <div class="card bg-light shadow-lg mx-auto" style="width: 600px;">
    <div class="card-body">
      <h5 class="card-title text-primary">HISTORIA CLÍNICA</h5>
      <form [formGroup]="motivoConsultaForm" (ngSubmit)="onSubmit()">
        <div formGroupName="historiaClinica">
          <label for="motivoConsulta">Motivo de Consulta:</label>
          <select id="motivoConsulta" formControlName="motivoConsulta" class="form-control" (change)="onCambioMotivoConsulta($event)">
            <option *ngFor="let motivoConsulta of historiaClinica[0].motivoConsulta " [value]="motivoConsulta"> {{ motivoConsulta }}</option>
          </select>
          <br>
          <div [attr.hidden]="!mostrarCuestionarioEDACS ? true : null" class="accordion">
            <div class="accordion-item">
              <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                  CUESTIONARIO EDACS
                </button>
                </h2>
              <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#accordionExample">
                <div class="accordion-body">
            <h6>Para descartar que el dolor torácico sea cardiogénico, rellenar la escala EDACS</h6>
                <form [formGroup]="cuestionarioEDACSForm" (ngSubmit)="onSubmit()">

                  <form>
                    <div class="mb-3">
                      <label for="exampleInputEmail1" class="form-label">Edad</label>
                      <input type="email" class="form-control" id="exampleInputEmail1" aria-describedby="emailHelp" (change)="seleccionarEdad($event)">
                    </div>
                  </form>

                  <form>
                  <!-- Agrega más preguntas con sus datalists -->
                  <label for="pregunta2" class="form-label"> Sexo: </label>
                  <br>
                  <div id="pregunta2" class="btn-group" role="group" aria-label="Basic radio toggle button group" >
                    <input type="radio" class="btn-check" name="btnradio" id="btnradio1" autocomplete="off" (click)="seleccionarSexoHombre()">
                    <label class="btn btn-outline-primary" for="btnradio1" > Hombre </label>

                    <input type="radio" class="btn-check" name="btnradio" id="btnradio2" autocomplete="off" (click)="seleccionarMujer()">
                    <label class="btn btn-outline-primary" for="btnradio2"> Mujer </label>

                  </div>
                </form>
                <br>
                <form>
                  <label for="pregunta3" class="form-label"> Diaforesis: </label>
                  <br>
                  <div id="pregunta3" class="btn-group" role="group" aria-label="Basic radio toggle button group" >
                    <input type="radio" class="btn-check" name="btnradio" id="btnpreg3.1" autocomplete="off" (click)="seleccionarDiaforesis()">
                    <label class="btn btn-outline-primary" for="btnpreg3.1" > Si </label>

                    <input type="radio" class="btn-check" name="btnradio" id="btnpreg3.2" autocomplete="off">
                    <label class="btn btn-outline-primary" for="btnpreg3.2"> No </label>

                  </div>
                </form>
                <br>
                <form>
                  <label for="pregunta4" class="form-label"> Dolor que ocurre o se agrava con la inspiración </label>
                  <br>
                  <div id="pregunta4" class="btn-group" role="group" aria-label="Basic radio toggle button group" >
                    <input type="radio" class="btn-check" name="btnradio" id="btnpreg4.1" autocomplete="off" (click)="seleccionarDiaforesis()">
                    <label class="btn btn-outline-primary" for="btnpreg4.1" > Si </label>

                    <input type="radio" class="btn-check" name="btnradio" id="btnpreg4.2" autocomplete="off">
                    <label class="btn btn-outline-primary" for="btnpreg4.2"> No </label>

                  </div>
                </form>
                <br>
                <form>
                  <label for="pregunta5" class="form-label"> Dolor a la digitopresión </label>
                  <br>
                  <div id="pregunta5" class="btn-group" role="group" aria-label="Basic radio toggle button group" >
                    <input type="radio" class="btn-check" name="btnradio" id="btnpreg5.1" autocomplete="off" (click)="seleccionarDiaforesis()">
                    <label class="btn btn-outline-primary" for="btnpreg5.1" > Si </label>

                    <input type="radio" class="btn-check" name="btnradio" id="btnpreg5.2" autocomplete="off">
                    <label class="btn btn-outline-primary" for="btnpreg.2"> No </label>

                  </div>
                </form>
                <br>
                <form id="antecedentesCoronarios">
                  <label for="antecedentesCoronarios"> Antecedentes Coronarios: </label>
                  <div class="btn-group" role="group" aria-label="Basic checkbox toggle button group">
                    <input type="checkbox" class="btn-check" id="btncheck1" autocomplete="off">
                    <label class="btn btn-outline-primary" for="btncheck1">Infarto coronario previo</label>

                    <input type="checkbox" class="btn-check" id="btncheck2" autocomplete="off">
                    <label class="btn btn-outline-primary" for="btncheck2">Bypass coronario</label>

                    <input type="checkbox" class="btn-check" id="btncheck3" autocomplete="off">
                    <label class="btn btn-outline-primary" for="btncheck3">Intervención percutánea coronaria</label>

                    <input type="checkbox" class="btn-check" id="btncheck4" autocomplete="off">
                    <label class="btn btn-outline-primary" for="btncheck4">Ninguno</label>
                  </div>
                </form>
                <br>
                <form id="antecedentesCardiovasculares">
                  <label for="antecedentesCardiovasculares"> Antecedentes Cariovasculares: </label>
                  <div class="btn-group" role="group" aria-label="Basic checkbox toggle button group">
                    <input type="checkbox" class="btn-check" id="btncheckACV1" autocomplete="off">
                    <label class="btn btn-outline-primary" for="btncheckACV1">Dislipidemia</label>

                    <input type="checkbox" class="btn-check" id="btncheckACV2" autocomplete="off">
                    <label class="btn btn-outline-primary" for="btncheckACV2">Diabetes</label>

                    <input type="checkbox" class="btn-check" id="btncheckACV3" autocomplete="off">
                    <label class="btn btn-outline-primary" for="btncheckACV3">Hipertensión</label>

                    <input type="checkbox" class="btn-check" id="btncheckACV4" autocomplete="off">
                    <label class="btn btn-outline-primary" for="btncheckACV4">Fumador</label>

                    <input type="checkbox" class="btn-check" id="btncheckACV5" autocomplete="off">
                    <label class="btn btn-outline-primary" for="btncheckACV5">Familiar con historia de enfermedad coronaria prematura</label>
                  </div>
                </form>
                <br>
                <form id="encuestaFormFactoresRiegoCardiovascular">

                      <button type="button" onclick="calcularPuntuacionLista2()">Calcular Puntuación</button>
                        <br>
                        <div id="resultadoLista2"></div>

                      <br><br>

                      <!-- Lista 3 -->
                      <label for="lista3">Ninguna de las anteriores:</label>
                      <select id="lista3" onchange="seleccionarOpcionLista3()">
                          <option value="" disabled selected>Selecciona una opción</option>
                          <option value="ninguna">Ninguna de las anteriores</option>
                      </select>

                      <br><br>
              </form>

              <form id="continuacionEncuestaform">
                      <!-- Pregunta 7 -->
                      <label for="pregunta7">Ha tenido enfermedad coronaria o 3 o más factores de riesgo</label>
                      <input list="opcionesPregunta7" id="pregunta7" name="pregunta7">
                      <datalist id="opcionesPregunta7">
                          <option value="Enfermedad coronaria"></option>
                          <option value="3 o mas factores de riesgo"></option>
                          <option value="Ninguna de las dos"></option>
                      </datalist>

                  <button type="button" onclick="calcularPuntajeEncuesta()">Calcular Puntaje</button>
              </form>

              <!-- Contenedor para mostrar el resultado -->
              <div id="resultadoEncuesta"></div>

              <script>
              var datalistPregunta1 = document.getElementById("opcionesPregunta1");
              for (var i = 18; i <= 100; i++) {
                  var option = document.createElement("option");
                  option.value = i;
                  datalistPregunta1.appendChild(option);
              }

              var optionMas100 = document.createElement("option");
              optionMas100.value = ">100";
              datalistPregunta1.appendChild(optionMas100);

              function calcularPuntajeEncuesta() {
                  var puntajeTotal = obtenerPuntajeEncuesta();
                  mostrarResultadosEncuesta(puntajeTotal);
              }

              function calcularPuntuacionLista2() {
                  var opcionesSeleccionadasLista2 = document.querySelectorAll('input[type="checkbox"]:checked');

                  if (opcionesSeleccionadasLista2.length >= 3) {
                      var pregunta7 = document.getElementById("pregunta7");
                      pregunta7.value = "3 o mas factores de riesgo";
                      lista1.style.display = "none";
                      lista3.style.display = "none";
                  }
                  else{
                      mostrarResultadolista2('Selecciona al menos dos opciones');
                  }
              }

              function mostrarResultadolista2(mensaje) {
                  var resultadoContainerLista2 = document.getElementById('resultadoLista2');
                  resultadoContainerLista2.innerHTML = mensaje;
              }

              function obtenerPuntajeEncuesta() {
                  var puntajeTotal = 0;

                  var respuestaPregunta1 = document.getElementById("pregunta1").value;
                  var respuestaPregunta2 = document.getElementById("pregunta2").value;
                  var respuestaPregunta3 = document.getElementById("pregunta3").value;
                  var respuestaPregunta4 = document.getElementById("pregunta4").value;
                  var respuestaPregunta5 = document.getElementById("pregunta5").value;
                  var respuestaPregunta6 = document.getElementById("pregunta6").value;
                  var respuestaPregunta7 = document.getElementById("pregunta7").value;

                  puntajeTotal += asignarPuntajePregunta1(respuestaPregunta1);
                  puntajeTotal += asignarPuntajePregunta2(respuestaPregunta2);
                  puntajeTotal += asignarPuntajePregunta3(respuestaPregunta3);
                  puntajeTotal += asignarPuntajePregunta4(respuestaPregunta4);
                  puntajeTotal += asignarPuntajePregunta5(respuestaPregunta5);
                  puntajeTotal += asignarPuntajePregunta6(respuestaPregunta6);
                  puntajeTotal += asignarPuntajePregunta7(respuestaPregunta7);

                  return puntajeTotal;
              }


              function asignarPuntajePregunta3(respuesta) {
                  if (respuesta === "Si") {
                      return 3;
                  } else if (respuesta === "No") {
                      return 0;
                  }
                  return 0;
              }

              function asignarPuntajePregunta4(respuesta) {
                  if (respuesta === "Si") {
                      return 5;
                  } else if (respuesta === "No") {
                      return 0;
                  }
                  return 0;
              }

              function asignarPuntajePregunta5(respuesta) {
                  if (respuesta === "Si") {
                      return -4;
                  } else if (respuesta === "No") {
                      return 0;
                  }
                  return 0;
              }

              function asignarPuntajePregunta6(respuesta) {
                  if (respuesta === "Si") {
                      return -6;
                  } else if (respuesta === "No") {
                      return 0;
                  }
                  return 0;
              }

              function asignarPuntajePregunta7(respuesta) {
                  if (respuesta === "Enfermedad coronaria") {
                      return 4;
                  } else if (respuesta === "3 o mas factores de riesgo") {
                      return 4;
                  }
                  return 0;
              }

              function seleccionarOpcionLista1() {
                  var lista1 = document.getElementById("lista1");
                  var lista2 = document.getElementById("lista2");
                  var lista3 = document.getElementById("lista3");



                  if (lista1.value === "infarto" || lista1.value === "bypass" || lista1.value === "intervencion") {
                      var pregunta7 = document.getElementById("pregunta7");
                      pregunta7.value = "Enfermedad coronaria";
                      lista2.style.display = "none";
                      lista3.style.display = "none";
                      checkboxOpcion1.style.display = "none";
                      checkboxOpcion2.style.display = "none";
                      checkboxOpcion3.style.display = "none";
                      checkboxOpcion4.style.display = "none";
                      checkboxOpcion5.style.display = "none";
                  }
              }

              function seleccionarOpcionLista2() {
                  var lista1 = document.getElementById("lista1");
                  var lista2 = document.getElementById("lista2");
                  var lista3 = document.getElementById("lista3");



                  var opcionesSeleccionadasLista2 = document.querySelectorAll('input[type="checkbox"]:checked');
                  if (opcionesSeleccionadasLista2.length >= 2) {
                      var pregunta7 = document.getElementById("pregunta7");
                      pregunta7.value = "3 o mas factores de riesgo";
                  }
              }

              function seleccionarOpcionLista3() {
                  var lista1 = document.getElementById("lista1");
                  var lista2 = document.getElementById("lista2");
                  var lista3 = document.getElementById("lista3");



                  var pregunta7 = document.getElementById("pregunta7");
                  if (lista3.value === "ninguna") {
                      pregunta7.value = "Ninguna de las dos";
                      lista1.style.display = "none";
                      lista2.style.display = "none";
                      checkboxOpcion1.style.display = "none";
                      checkboxOpcion2.style.display = "none";
                      checkboxOpcion3.style.display = "none";
                      checkboxOpcion4.style.display = "none";
                      checkboxOpcion5.style.display = "none";
                  }
              }

              function mostrarResultadosEncuesta(puntajeTotal) {
                  var resultadoEncuestaContainer = document.getElementById("resultadoEncuesta");
                  resultadoEncuestaContainer.innerHTML = "El puntaje total de la encuesta es: " + puntajeTotal;

                  if (puntajeTotal >= 16) {
                      resultadoEncuestaContainer.innerHTML += '<br>Realizar "EKG y enzimas cardiacas';
                      resultadoEncuestaContainer.innerHTML += '<br><button onclick="redirigirSiguiente()">Siguiente</button>';
                  } else {
                      resultadoEncuestaContainer.innerHTML += '<br>Realizar solo "EKG"';
                      resultadoEncuestaContainer.innerHTML += '<br><button onclick="redirigirOtraPagina()">Siguiente</button>';
                  }
              }

              function redirigirSiguiente() {
                  // Redireccionar a la página correspondiente
                  window.location.href = "tu_pagina_siguiente.html";
              }

              function redirigirOtraPagina() {
                  // Redireccionar a otra página correspondiente
                  window.location.href = "otra_pagina.html";
              }
              </script>
                </form>
              </div>
            </div>
          </div>
          </div>
        </div>
        <button type="submit">Enviar</button>
      </form>
    </div>
  </div>
</div>
